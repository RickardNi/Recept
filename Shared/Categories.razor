@page "/categories"
@inject RecipeService RecipeService

@if (isLoading)
{
    <p>Laddar recept...</p>
}
else
{
    <div class="categories-layout">
        <aside class="categories-sidebar">
            <ul class="category-list">
                @foreach (var category in categories)
                {
                    <li>
                        <button class="category-item @(selectedCategory == category ? "active" : "")"
                                @onclick="() => SelectCategory(category)">
                            @if (CategoryIcons.TryGetValue(category, out var icon))
                            {
                                @((MarkupString)icon)
                            }
                            @category
                        </button>
                    </li>
                }
            </ul>
        </aside>
        <div class="categories-recipes">
            <h1 class="categories-heading">@selectedCategory</h1>
            @if (filteredRecipes.Count == 0)
            {
                <p>Inga recept i den här kategorin.</p>
            }
            else
            {
                <ul class="recipe-list">
                    @foreach (var recipe in filteredRecipes.OrderBy(r => r.Title))
                    {
                        <li>
                            <a href="/recipe/@recipe.Slug">@recipe.Title</a>
                        </li>
                    }
                </ul>
            }
        </div>
    </div>
}

@code {
    private static readonly Dictionary<string, string> CategoryIcons = new()
    {
        ["Veganskt"] = """<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8q6 0 6-6-6 0-6 6"/><path d="M17.41 3.59a10 10 0 1 0 3 3"/><path d="M2 2a26.6 26.6 0 0 1 10 20c.9-6.82 1.5-9.5 4-14"/></svg>""",
        ["Grytor"]   = """<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 12h20"/><path d="M20 12v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2v-8"/><path d="m4 8 16-4"/><path d="m8.86 6.78-.45-1.81a2 2 0 0 1 1.45-2.43l1.94-.48a2 2 0 0 1 2.43 1.46l.45 1.8"/></svg>""",
        ["Middag"]   = """<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"/><path d="M7 2v20"/><path d="M21 15V2a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7"/></svg>""",
        ["Matlådor"] = """<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="20" height="15" x="2" y="4" rx="2"/><rect width="8" height="7" x="6" y="8" rx="1"/><path d="M18 8v7"/><path d="M6 19v2"/><path d="M18 19v2"/></svg>""",
    };

    private List<RecipeMetadata> allRecipes = new();
    private List<string> categories = new();
    private List<RecipeMetadata> filteredRecipes = new();
    private string selectedCategory = string.Empty;
    private bool isLoading = true;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            allRecipes = await RecipeService.GetAllRecipesAsync();
            categories = allRecipes
                .SelectMany(r => r.Categories)
                .Distinct()
                .OrderBy(c => c)
                .ToList();

            if (categories.Count > 0)
                SelectCategory(categories[0]);
        }
        finally
        {
            isLoading = false;
        }
    }

    private void SelectCategory(string category)
    {
        selectedCategory = category;
        filteredRecipes = allRecipes
            .Where(r => r.Categories.Contains(category))
            .ToList();
    }
}